<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test MongoDB Connection</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 800px;
            margin: 50px auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .result {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-top: 20px;
        }
        .success { color: #28a745; }
        .error { color: #dc3545; }
        pre {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 5px;
            overflow-x: auto;
        }
        .btn {
            background: #667eea;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            margin: 5px;
        }
        .btn:hover {
            background: #5568d3;
        }
    </style>
</head>
<body>
    <h1>MongoDB Connection Test</h1>
    <p>This page tests the connection to MongoDB Atlas and the business logic.</p>
    
    <button class="btn" onclick="testConnection()">Test Connection</button>
    <button class="btn" onclick="addSampleData()">Add Sample Professor</button>
    <button class="btn" onclick="testBusinessLogic()">Test Business Logic</button>
    
    <div id="result" class="result"></div>

    <script>
        async function testConnection() {
            const resultDiv = document.getElementById('result');
            resultDiv.innerHTML = '<p>Testing connection...</p>';
            
            try {
                const response = await fetch('php/read_all.php');
                const data = await response.json();
                
                if (data.success) {
                    resultDiv.innerHTML = `
                        <h3 class="success">✓ Connection Successful!</h3>
                        <p>Found ${data.count} professor(s) in database.</p>
                        <pre>${JSON.stringify(data, null, 2)}</pre>
                    `;
                } else {
                    resultDiv.innerHTML = `
                        <h3 class="error">✗ Connection Failed</h3>
                        <p>${data.message}</p>
                    `;
                }
            } catch (error) {
                resultDiv.innerHTML = `
                    <h3 class="error">✗ Error</h3>
                    <p>${error.message}</p>
                `;
            }
        }

        async function addSampleData() {
            const resultDiv = document.getElementById('result');
            resultDiv.innerHTML = '<p>Adding sample professor...</p>';
            
            const sampleProfessor = {
                name: "Dr. Jane Anderson",
                department: "Computer Science",
                specialty: "Artificial Intelligence",
                years_experience: 12,
                salary: 85000
            };
            
            try {
                const response = await fetch('php/insert.php', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(sampleProfessor)
                });
                
                const data = await response.json();
                
                if (data.success) {
                    resultDiv.innerHTML = `
                        <h3 class="success">✓ Sample Professor Added!</h3>
                        <p>ID: ${data.id}</p>
                        <pre>${JSON.stringify(sampleProfessor, null, 2)}</pre>
                    `;
                } else {
                    resultDiv.innerHTML = `
                        <h3 class="error">✗ Failed to Add</h3>
                        <p>${data.message}</p>
                    `;
                }
            } catch (error) {
                resultDiv.innerHTML = `
                    <h3 class="error">✗ Error</h3>
                    <p>${error.message}</p>
                `;
            }
        }

        function testBusinessLogic() {
            const resultDiv = document.getElementById('result');
            
            // Test case 1: Senior with high-demand specialty
            const test1 = {
                name: "Prof. AI Expert",
                salary: 100000,
                years_experience: 20,
                specialty: "Artificial Intelligence"
            };
            
            // Expected: 20*2% + 15% + 10% = 40% + 15% + 10% = 65% = $65,000
            
            // Test case 2: Mid-career regular specialty
            const test2 = {
                name: "Prof. Mid Career",
                salary: 60000,
                years_experience: 8,
                specialty: "Literature"
            };
            
            // Expected: 8*2% + 5% = 16% + 5% = 21% = $12,600
            
            resultDiv.innerHTML = `
                <h3>Business Logic Test Cases</h3>
                
                <h4>Test Case 1: Senior AI Expert</h4>
                <pre>${JSON.stringify(test1, null, 2)}</pre>
                <p><strong>Expected Bonus:</strong> ~$65,000 (65%)</p>
                <ul>
                    <li>Experience: 20 years × 2% = 40% = $40,000</li>
                    <li>High-demand specialty: 15% = $15,000</li>
                    <li>Senior leadership: 10% = $10,000</li>
                </ul>
                
                <h4>Test Case 2: Mid-Career Regular Specialty</h4>
                <pre>${JSON.stringify(test2, null, 2)}</pre>
                <p><strong>Expected Bonus:</strong> ~$12,600 (21%)</p>
                <ul>
                    <li>Experience: 8 years × 2% = 16% = $9,600</li>
                    <li>Mid-career merit: 5% = $3,000</li>
                </ul>
                
                <p><em>Add these professors and check if bonuses match expectations!</em></p>
            `;
        }

        // Auto-test on load
        window.addEventListener('load', testConnection);
    </script>
</body>
</html>
